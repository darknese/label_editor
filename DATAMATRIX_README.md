# Работа с Datamatrix GS1

## Обзор

Система поддерживает создание и работу с Datamatrix GS1 кодами для этикеток. Включает создание тестовых кодов, placeholder для реальных кодов и экспорт шаблонов.

## Возможности

### 1. Создание тестовых Datamatrix
- **Кнопка**: "Создать тестовый Datamatrix" в панели Datamatrix
- **Функция**: Автоматически генерирует тестовый GS1 код
- **Формат**: `(01)12345678901234(21)123456`
- **Использование**: Для разработки и тестирования шаблонов

### 2. Создание placeholder
- **Опция**: "Создать placeholder" в панели Datamatrix
- **Функция**: Создает место для вставки реального Datamatrix
- **Настройка**: Можно изменить текст placeholder
- **Использование**: Для шаблонов, которые будут заполняться реальными кодами

### 3. Создание кастомных Datamatrix
- **Поле**: "Код Datamatrix" в панели Datamatrix
- **Валидация**: Проверка формата GS1
- **Функция**: Создание Datamatrix с пользовательским кодом

### 4. Экспорт с placeholder
- **Опция**: "Конвертировать тестовые Datamatrix в placeholder"
- **Функция**: При экспорте тестовые коды заменяются на placeholder
- **Результат**: Шаблон готов для заполнения реальными кодами

## Формат Datamatrix GS1

### Структура кода:
```
(01)GTIN(21)Serial
```

### Компоненты:
- **GTIN (Global Trade Item Number)**: 14 цифр
- **Serial Number**: 1-20 цифр (опционально)

### Примеры:
- `(01)12345678901234(21)123456` - Полный код
- `(01)12345678901234` - Только GTIN

## Валидация

### Правила валидации:
1. **GTIN**: Ровно 14 цифр после (01)
2. **Serial**: 1-20 цифр после (21) (опционально)
3. **Формат**: Строго `(01)GTIN(21)Serial`

### Ошибки валидации:
- Неверный формат GTIN
- Неверный формат Serial
- Отсутствие обязательных компонентов

## Типы Datamatrix элементов

### 1. Тестовый Datamatrix
- **Визуально**: Белый фон, черный текст
- **Индикатор**: "TEST" в углу
- **Использование**: Для разработки шаблонов

### 2. Placeholder
- **Визуально**: Серый фон, серый текст
- **Индикатор**: "PLACEHOLDER" в углу
- **Использование**: Для готовых шаблонов

### 3. Кастомный Datamatrix
- **Визуально**: Белый фон, черный текст
- **Индикатор**: "TEST" в углу
- **Использование**: Для специфических кодов

## Рабочий процесс

### 1. Создание шаблона с тестовыми кодами:
1. Выберите инструмент "Datamatrix"
2. Создайте тестовые Datamatrix элементы
3. Добавьте другие элементы (текст, изображения)
4. Сохраните шаблон

### 2. Экспорт для производства:
1. Откройте сохраненный шаблон
2. Нажмите "Экспорт JSON"
3. Включите опцию "Конвертировать тестовые Datamatrix в placeholder"
4. Экспортируйте шаблон

### 3. Заполнение реальными кодами:
1. Импортируйте шаблон с placeholder
2. Замените placeholder на реальные Datamatrix коды
3. Используйте для печати этикеток

## API для Datamatrix

### Создание элемента:
```typescript
createElement('datamatrix', {
  datamatrixCode: '(01)12345678901234(21)123456',
  isPlaceholder: false,
  placeholderText: 'Datamatrix GS1',
  x: 100,
  y: 100,
  width: 150,
  height: 50,
});
```

### Структура элемента:
```typescript
type DatamatrixElement = {
  id: string;
  type: 'datamatrix';
  props: {
    datamatrixCode?: string;
    isPlaceholder: boolean;
    placeholderText: string;
    x: number;
    y: number;
    width: number;
    height: number;
    draggable: boolean;
  };
};
```

## Интеграция с шаблонами

### Сохранение шаблона:
- Тестовые Datamatrix сохраняются как есть
- Placeholder сохраняются с флагом `isPlaceholder: true`

### Экспорт шаблона:
- Опция конвертации тестовых кодов в placeholder
- Сохранение метаданных экспорта
- Поддержка версионирования

### Импорт шаблона:
- Автоматическое восстановление Datamatrix элементов
- Поддержка как тестовых, так и placeholder элементов

## Визуальные особенности

### Тестовый Datamatrix:
- Белый фон
- Черный текст
- Красный индикатор "TEST"
- Полный код отображается

### Placeholder:
- Серый фон
- Серый текст
- Зеленый индикатор "PLACEHOLDER"
- Текст placeholder отображается

### Выделение:
- Синяя рамка при выделении
- Поддержка трансформации
- Перетаскивание

## Обработка ошибок

### Валидация при создании:
- Проверка формата GS1
- Показ понятных сообщений об ошибках
- Предотвращение создания неверных кодов

### Обработка при экспорте:
- Подсчет Datamatrix элементов
- Информация о количестве тестовых кодов
- Предупреждения о конвертации

## Рекомендации

### Для разработки:
1. Используйте тестовые Datamatrix для создания шаблонов
2. Размещайте элементы с учетом размеров реальных кодов
3. Тестируйте с разными размерами кодов

### Для производства:
1. Экспортируйте шаблоны с placeholder
2. Используйте единообразные размеры для Datamatrix
3. Проверяйте качество печати кодов

### Для интеграции:
1. Используйте стандартный формат GS1
2. Поддерживайте валидацию кодов
3. Обеспечивайте обратную совместимость 